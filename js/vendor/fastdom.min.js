!function(t){"use strict";function e(){this.frames=[],this.lastId=0,this.raf=i,this.batch={hash:{},read:[],write:[],mode:null}}{var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||function(t){window.clearTimeout(t)}}e.prototype.read=function(t,e){var i=this.add("read",t,e),n=i.id;this.batch.read.push(i.id);var o="reading"===this.batch.mode||this.batch.scheduled;return o?n:(this.scheduleBatch(),n)},e.prototype.write=function(t,e){var i=this.add("write",t,e),n=this.batch.mode,o=i.id;this.batch.write.push(i.id);var a="writing"===n||"reading"===n||this.batch.scheduled;return a?o:(this.scheduleBatch(),o)},e.prototype.defer=function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);var n=this,o=t-1;return this.schedule(o,function(){n.run({fn:e,ctx:i})})},e.prototype.clear=function(t){if("function"==typeof t)return this.clearFrame(t);var e=this.batch.hash[t];if(e){var i=this.batch[e.type],n=i.indexOf(t);delete this.batch.hash[t],~n&&i.splice(n,1)}},e.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},e.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},e.prototype.uniqueId=function(){return++this.lastId},e.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},e.prototype.runBatch=function(){try{this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},e.prototype.add=function(t,e,i){var n=this.uniqueId();return this.batch.hash[n]={id:n,fn:e,ctx:i,type:t}},e.prototype.run=function(t){var e=t.ctx||this,i=t.fn;if(delete this.batch.hash[t.id],!this.onError)return i.call(e);try{i.call(e)}catch(n){this.onError(n)}},e.prototype.loop=function(){var t=this,e=this.raf;this.looping||(e(function i(){var n=t.frames.shift();t.frames.length?e(i):t.looping=!1,n&&n()}),this.looping=!0)},e.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)},t=t||new e,"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.fastdom=t}(window.fastdom);